#table creation

CREATE TABLE JIOMART_CASHBACK_BAL(PHONE_NUMBER NUMBER,CASHBACK_AMOUNT NUMBER);


INSERT INTO JIOMART_CASHBACK_BAL VALUES(9876543210,965.64);
COMMIT;


SELECT * FROM JIOMART_CASHBACK_BAL;

#jiomart available cashback balance

CREATE OR REPLACE PROCEDURE JIOMART_CASHBACK_BAL_DETAILS(P_PHONE IN NUMBER,P_PAYABLE_AMOUNT IN NUMBER,P_CASHBACK_AMOUNT OUT VARCHAR2,P_REDEEMABLE_AMOUNT OUT VARCHAR2)
AS
   L_CASHBACK_AMOUNT NUMBER;
   L_REDEEMABLE_AMOUNT NUMBER;
BEGIN
   SELECT CASHBACK_AMOUNT INTO L_CASHBACK_AMOUNT FROM JIOMART_CASHBACK_BALANCE WHERE PHONE_NUMBER=P_PHONE;
  P_CASHBACK_AMOUNT:='JIOMART CASHBACK BALANCE RS.'||L_CASHBACK_AMOUNT;
  L_REDEEMABLE_AMOUNT:=ROUND(P_PAYABLE_AMOUNT*(20/100),2);
  P_REDEEMABLE_AMOUNT:='MAX REDEEMABLE FOR THIS TRANSACTION IS RS.'||L_REDEEMABLE_AMOUNT;
END JIOMART_CASHBACK_BAL_DETAILS;

#execution of procedure
 
DECLARE
  CASHBACK_MSG VARCHAR2(100);
  REDEEMPTION_MSG VARCHAR2(100);
BEGIN
  JIOMART_CASHBACK_BAL_DETAILS(9876543210,479,CASHBACK_MSG,REDEEMPTION_MSG);
  DBMS_OUTPUT.PUT_LINE(CASHBACK_MSG);
  DBMS_OUTPUT.PUT_LINE(REDEEMPTION_MSG);
END;

#redeemable amount

CREATE OR REPLACE PROCEDURE JIOMART_CASHBACK_BAL_REDEEMPTION(P_PHONE IN NUMBER,P_REDEEMABLE_AMT IN NUMBER,P_USER_ENTER_VALUE IN NUMBER,P_MSG OUT VARCHAR2)
AS
BEGIN
    IF P_REDEEMABLE_AMT>=P_USER_ENTER_VALUE THEN
       UPDATE JIOMART_CASHABACK_BALANCE SET CASHBACK_AMOUNT=CASHBACK_AMOUNT-NVL(P_USER_ENTER_VALUE,0) WHERE PHONE_NUMBER=P_PHONE;
    COMMIT;
        P_MSG:='AMMOUNT REDEEMED SUCESSFULLY';
    ELSE
        P_MSG:='AMOUNT CANNOT BE GREATER THAN REDEEMABLE LIMIT';
    END IF;  
END JIIOMART_CASHBACK_BAL_REDEEMPTION;

#execution of procedure

DECLARE
  MSG VARCHAR2(100);
BEGIN
 JIOMART_CASHBACK_BAL_REDEEMPTION(9876543210,95.80,95.80,MSG);
 DBMS_OUTPUT.PUT_LINE(MSG);
END;                                                         